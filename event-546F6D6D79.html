<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NR7C688Z');</script>
<!-- End Google Tag Manager -->
<!-- Google Tag Manager --><meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Will the New LRA Protect You or Expose You? — VCB</title>

  <!-- Quicksand: 400, 500, 600, 700 (enhanced readability) -->
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <style>
    :root{
      --black:#0B0B0B;
      --g-900:#111; --g-800:#1A1A1A; --g-700:#2A2A2A; --g-600:#3D3D3D;
      --g-500:#565656; --g-400:#777; --g-300:#9A9A9A; --g-200:#D5D5D5; --g-100:#EFEFEF;
      --white:#fff;
      --gold:#D4AF37;
      --gold-dark:#B8942D;
      --max:1200px; --radius:18px;
    }
    *{box-sizing:border-box}
    html{
      background:var(--black);
    }
    body{
      margin:0; background:var(--white);
      color:var(--black);
      font-family:"Quicksand", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      font-weight:500; line-height:1.7; -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      text-rendering:optimizeLegibility;
      scroll-behavior:smooth;
    }
    h1,h2,h3,h4{ font-weight:700; color:var(--black); margin:0 0 .6rem; letter-spacing:-.01em; text-rendering:optimizeLegibility; -webkit-font-smoothing:antialiased; text-shadow:0 2px 8px rgba(0,0,0,.3); }
    h1{ font-size:clamp(42px,5.6vw,72px); line-height:1.05; letter-spacing:-.02em; font-weight:700; }
    h2{ font-size:clamp(28px,3.6vw,42px); letter-spacing:-.01em; margin-bottom:1rem; font-weight:700; }
    h3{ font-size:clamp(20px,2.4vw,26px); color:#333; letter-spacing:-.005em; font-weight:600; text-shadow:0 1px 4px rgba(0,0,0,.3); }
    p{ margin:.45rem 0 1rem; color:#333; font-weight:500; text-shadow:0 1px 3px rgba(0,0,0,.2); }
    .wrap{ max-width:var(--max); margin:0 auto; padding:0 20px; }
    .section{ padding:96px 0; position:relative; }

    /* Top nav */
    .top{
      position:sticky; top:0; z-index:20;
      background:rgba(11,11,11,0.95);
      -webkit-backdrop-filter:blur(10px); backdrop-filter:blur(10px);
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .nav{ display:flex; align-items:center; justify-content:space-between; padding:8px 0; }
    .brand{ display:flex; align-items:center; }
    .brand img{ height:240px; width:auto; }
    .nav nav a{
      color:#D5D5D5; text-decoration:none; margin-left:16px; position:relative; padding:4px 2px;
      font-size:2em; font-weight:700;
      transition:all .3s cubic-bezier(0.4, 0, 0.2, 1);
      text-rendering:optimizeLegibility;
      text-shadow:0 1px 3px rgba(0,0,0,.3);
    }
    .nav nav a:hover{ color:#FFFFFF; transform:scale(0.95); }

    /* Hero */
    .hero{
      position:relative; overflow:hidden; padding:120px 0 80px;
      background:radial-gradient(ellipse at top, rgba(212,175,55,.15) 0%, transparent 70%);
    }
    .hero h1{
      background:linear-gradient(135deg, var(--gold) 0%, var(--black) 100%);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
      background-clip:text;
    }
    .exclusive-badge{
      display:inline-block; padding:8px 20px; border-radius:999px;
      background:linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
      color:#0B0B0B; font-weight:700; font-size:13px; letter-spacing:1.5px;
      text-transform:uppercase; margin-bottom:24px;
      box-shadow:0 4px 20px rgba(212,175,55,.3);
      text-rendering:optimizeLegibility;
    }
    .lede{ color:#555; max-width:940px; font-size:clamp(16px, 2vw, 19px); line-height:1.8; font-weight:500; text-shadow:0 1px 3px rgba(0,0,0,.2); }

    /* Cards */
    .card{
      position:relative;
      background:linear-gradient(135deg, rgba(250,250,250,.8) 0%, rgba(240,240,240,.6) 100%);
      border:1px solid rgba(0,0,0,.1);
      border-radius:var(--radius); padding:32px;
      -webkit-backdrop-filter:blur(12px); backdrop-filter:blur(12px);
      box-shadow:0 8px 32px rgba(0,0,0,.4);
      transition:all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .card:hover{
      transform:translateY(-12px) scale(1.01);
      box-shadow:0 16px 48px rgba(0,0,0,.6);
      border-color:rgba(212,175,55,.3);
    }

    .grid-2{ display:grid; gap:28px; grid-template-columns:1fr; }
    @media(min-width:900px){ .grid-2{ grid-template-columns:1fr 1fr; } }

    /* Details list */
    .detail-list{
      list-style:none; padding:0; margin:24px 0;
    }
    .detail-list li{
      padding:16px 0; border-bottom:1px solid rgba(0,0,0,.08);
      display:flex; justify-content:space-between; align-items:center;
      color:#333;
    }
    .detail-list li:last-child{ border:0; }
    .detail-list .label{ color:#555; font-size:14px; text-transform:uppercase; letter-spacing:1px; font-weight:600; text-shadow:0 1px 2px rgba(0,0,0,.2); }
    .detail-list .value{ color:var(--black); font-weight:600; font-size:18px; text-shadow:0 1px 3px rgba(0,0,0,.3); }

    /* CTA */
    .btn{
      display:inline-block;
      border:2px solid var(--gold); color:#D4AF37;
      text-decoration:none;
      padding:16px 36px; border-radius:14px; font-weight:700; font-size:16px;
      background:linear-gradient(135deg, rgba(212,175,55,.1) 0%, rgba(184,148,45,.05) 100%);
      box-shadow:0 4px 20px rgba(212,175,55,.2);
      transition:all .35s cubic-bezier(0.4, 0, 0.2, 1);
      position:relative; overflow:hidden; z-index:1;
      text-transform:uppercase; letter-spacing:1.2px;
      text-rendering:optimizeLegibility;
      text-shadow:0 1px 3px rgba(0,0,0,.3);
    }
    .btn::before{
      content:""; position:absolute; inset:0; background:var(--gold);
      transform:translateY(100%); transition:transform .35s cubic-bezier(0.4, 0, 0.2, 1);
      z-index:-1;
    }
    .btn:hover{ color:var(--black); transform:translateY(-2px); box-shadow:0 8px 32px rgba(212,175,55,.4); }
    .btn:hover::before{ transform:translateY(0); }

    footer{
      border-top:1px solid rgba(0,0,0,.08);
      color:#555; font-size:14px; text-align:center; padding:48px 0;
      font-weight:500;
      text-shadow:0 1px 2px rgba(0,0,0,.2);
    }

    /* Mobile Optimization */
    @media(max-width:768px){
      .wrap{ padding:0 16px; }

      /* Smaller logo for mobile */
      .brand img{ height:120px; }

      /* Reduce nav font size for mobile */
      .nav{ padding:6px 0; }
      .nav nav a{
        font-size:1.1em;
        margin-left:12px;
      }

      /* Adjust hero spacing */
      .hero{ padding:60px 0 40px; }

      /* Smaller badge */
      .exclusive-badge{
        font-size:11px;
        padding:6px 14px;
        letter-spacing:1px;
      }

      /* Better mobile typography */
      h1{ font-size:clamp(28px,7vw,42px); }
      h2{ font-size:clamp(22px,5vw,32px); }
      h3{ font-size:clamp(18px,4vw,24px); }

      /* Reduce section padding */
      .section{ padding:48px 0; }

      /* Smaller card padding */
      .card{ padding:20px; }

      /* Stack detail list on mobile */
      .detail-list li{
        flex-direction:column;
        align-items:flex-start;
        gap:4px;
        padding:12px 0;
      }
      .detail-list .label{ font-size:12px; }
      .detail-list .value{ font-size:16px; }

      /* Full width button on mobile */
      .btn{
        display:block;
        width:100%;
        max-width:320px;
        margin:0 auto;
        padding:14px 24px;
        font-size:14px;
        text-align:center;
      }

      /* Disable hover effects on mobile */
      .card:hover{
        transform:none;
        box-shadow:0 8px 32px rgba(0,0,0,.4);
      }

      /* Better spacing for lists */
      ul{ margin-left:0.8rem; }
      li{ font-size:15px; }
    }

    /* Extra small mobile */
    @media(max-width:480px){
      .brand img{ height:90px; }

      .nav nav a{
        font-size:0.95em;
        margin-left:8px;
      }

      h1{ font-size:clamp(24px,8vw,36px); }

      .card{ padding:16px; }

      .exclusive-badge{ font-size:10px; padding:5px 12px; }
    }
    /* Action buttons */
    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      padding:14px 22px; border-radius:999px; border:0; cursor:pointer;
      background:linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
      color:#0B0B0B; font-weight:700; font-size:16px; text-decoration:none;
      box-shadow:0 6px 22px rgba(212,175,55,.35);
      transition:transform .2s ease, box-shadow .2s ease, opacity .2s ease;
    }
    .btn:hover{ transform:translateY(-1px); box-shadow:0 10px 28px rgba(212,175,55,.45); }
    .btn:active{ transform:translateY(0); box-shadow:0 6px 18px rgba(212,175,55,.30); }

    .btn-row{ display:flex; gap:16px; justify-content:center; align-items:center; flex-wrap:wrap; margin-top:16px; }

    /* Transparent video modal (popover) */
    .video-modal{
      position:fixed; inset:0; display:none; background:transparent !important; z-index:0;
    }
    .video-modal.active{ display:block; }
    .video-modal__inner{
      position:absolute; pointer-events:auto; width:min(36vw, 360px);
      overflow:hidden; background:white !important; z-index:10000;
    }
    .video-modal__close{
      position:absolute; top:10px; right:10px; z-index:10001;
      background:rgba(0,0,0,0.5); color:white; border:none; font-size:20px; cursor:pointer;
      width:30px; height:30px; border-radius:50%; display:flex; align-items:center; justify-content:center;
    }
    .video-modal__video{
      pointer-events:auto; display:block;
      max-width:min(36vw, 360px);
      width:100%; height:auto; object-fit:contain;
      background:transparent !important; border:0; outline:0;
    }
    .video-modal__canvas{
      pointer-events:none; /* allow clicks to reach video */
      position:absolute; inset:0; /* overlay canvas on top of video */
      max-width:min(22.5vw, 225px);
      width:100%; height:100%; object-fit:contain;
      background:transparent !important; border:0; outline:0;
      image-rendering:optimizeQuality;
    }
  </style>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=AW-17625349992"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);} 
  gtag('js', new Date());

  gtag('config', 'AW-17625349992');
</script>
</head>
<body>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NR7C688Z"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

  <!-- Top nav -->
  <div class="top">
    <div class="wrap nav">
      <a href="index.html" class="brand"><img src="https://i.postimg.cc/xdJqP9br/logo-transparent-Black-Back.png" alt="VCB - Viable Core Business"></a>
      <nav>
        <a href="index.html">Home</a>
        <a href="aboutus.html">About</a>
      </nav>
    </div>
  </div>

  <!-- Hero -->
  <header class="hero">
    <div class="wrap">
      <div class="exclusive-badge">Open to All · R200 per person</div>
      <h1>Will the New LRA Protect You or Expose You?</h1>
      <p class="lede">
        The first biggest change in 30 years to dismissals. High Court Advocates debate and discuss the new Schedule 8 of the LRA. Every employee and employer must know the impact.
      </p>
      <p class="lede" style="margin-top:24px; font-size:clamp(18px, 2.2vw, 22px); color:var(--gold); font-weight:500;">
        Is Your Job Safer Now? The Real Impact of LRA Changes
      </p>
      <p class="lede" style="margin-top:16px; font-size:clamp(15px, 1.8vw, 18px); color:var(--g-200);">
        16 October 2025 · Microsoft Teams
      </p>
      <p style="margin-top:32px; font-size:14px; color:var(--g-400); letter-spacing:1px; text-transform:uppercase;">
        Sponsored by <span style="color:var(--gold); font-weight:600;">LIANELA</span>
      </p>
    </div>
  </header>

  <main class="wrap">

    <!-- Event Details -->
    <section class="section">
      <h2 class="btn" style="display: inline-block; margin: 0 auto 24px; cursor: default;">⚖️ Event Details</h2>
      <div class="grid-2" style="margin-top:32px;">
        <div class="card">
          <h3>When & Where</h3>
          <ul class="detail-list">
            <li>
              <span class="label">Date</span>
              <span class="value">16 October 2025</span>
            </li>
            <li>
              <span class="label">Time</span>
              <span class="value">15:00 SAST</span>
            </li>
            <li>
              <span class="label">Venue</span>
              <span class="value">Virtual Event</span>
            </li>
            <li>
              <span class="label">Format</span>
              <span class="value">Microsoft Teams Only</span>
            </li>
            <li>
              <span class="label">Admission</span>
              <span class="value">R200 per person</span>
            </li>
          </ul>
        </div>

        <div class="card">
          <h3>What to Expect</h3>
          <p style="color:var(--g-200); margin-bottom:24px;">
            High Court Advocates will debate and discuss the new Schedule 8 of the LRA—the biggest change to dismissals in 30 years. What's changed, what it means for you, and how to prepare.
          </p>
          <ul style="list-style:none; padding:0; margin:0;">
            <li style="margin:12px 0; padding-left:24px; position:relative; color:var(--g-200);">
              <span style="position:absolute; left:0; color:var(--gold);">→</span>
              Understanding the new Schedule 8: dismissal changes explained
            </li>
            <li style="margin:12px 0; padding-left:24px; position:relative; color:var(--g-200);">
              <span style="position:absolute; left:0; color:var(--gold);">→</span>
              Live debate: How Schedule 8 impacts employer rights and obligations
            </li>
            <li style="margin:12px 0; padding-left:24px; position:relative; color:var(--g-200);">
              <span style="position:absolute; left:0; color:var(--gold);">→</span>
              Live debate: How the new framework protects (or exposes) employees
            </li>
            <li style="margin:12px 0; padding-left:24px; position:relative; color:var(--g-200);">
              <span style="position:absolute; left:0; color:var(--gold);">→</span>
              Is your job safer now? Real-world impact analysis
            </li>
            <li style="margin:12px 0; padding-left:24px; position:relative; color:var(--g-200);">
              <span style="position:absolute; left:0; color:var(--gold);">→</span>
              Open Q&A with High Court Advocates
            </li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Who Should Attend -->
    <section class="section" style="text-align: center;">
      <h2 class="btn" style="display: inline-block; margin: 0 auto 24px; cursor: default;">👥 Who Should Attend</h2>
      <div class="card" style="margin-top:32px;">
        <p style="font-size:18px; color:var(--g-200); margin-bottom:32px;">
          This event is essential for anyone impacted by labour law—whether you employ others or are employed yourself.
        </p>
        <div class="grid-2">
          <div>
            <h3 style="font-size:18px; margin-bottom:16px; color:var(--gold);">Employers & Business Owners</h3>
            <ul style="list-style:disc; padding-left:20px; color:var(--g-300);">
              <li>Business owners (SMEs & corporates)</li>
              <li>HR professionals & managers</li>
              <li>Operations & compliance teams</li>
              <li>Legal advisors & in-house counsel</li>
            </ul>
          </div>
          <div>
            <h3 style="font-size:18px; margin-bottom:16px; color:var(--gold);">Employees & Representatives</h3>
            <ul style="list-style:disc; padding-left:20px; color:var(--g-300);">
              <li>Employees at all levels</li>
              <li>Union representatives</li>
              <li>Shop stewards</li>
              <li>Anyone interested in labour rights</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- Intros -->
    <section class="section" style="text-align:center;">
      <h2>Watch A Quick Intro</h2>
      <p class="lede" style="margin:16px auto 24px;">Choose your perspective.</p>
      <div class="btn-row">
        <button class="btn" type="button" data-side="left" data-video-webm="" data-video-src="Videos/2.mp4">For Employees</button>
        <button class="btn" type="button" data-side="right" data-video-webm="" data-video-src="Videos/1.mp4">For Employers</button>
      </div>
    </section>

    <!-- Countdown Clock -->
    <div id="countdown-root" style="position:relative; z-index:100; text-align:center; margin: 60px 0 40px 0;"></div>

    <!-- Hidden div to ensure Tailwind includes countdown classes -->
    <div class="hidden w-full h-full flex items-center justify-center text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-mono text-zinc-900 bg-gradient-to-b from-gray-200 via-white to-gray-300 shadow-inner rounded-t-lg rounded-b-lg items-end pb-1 items-start pt-1 border-b border-black/20 relative w-8 h-14 sm:w-10 sm:h-16 md:w-12 md:h-20 lg:w-14 lg:h-24 perspective shadow-lg shadow-black/60 overflow-hidden absolute top-0 left-0 bg-[linear-gradient(165deg,rgba(255,255,255,0.2)_0%,rgba(255,255,255,0)_20%)] z-30 pointer-events-none top-1/2 h-1/2 -mt-px h-px bg-black/50 z-20 origin-bottom transition-transform duration-500 ease-[cubic-bezier(0.45,0,0.55,1)] preserve-3d [transform:rotateX(-180deg)] inset-0 backface-hidden z-10 [transform:rotateX(180deg)] flex-col gap-1 md:gap-2 w-1 h-1 md:w-2 md:h-2 rounded-full bg-zinc-800 ring-1 ring-inset ring-zinc-700 gap-0.5 md:gap-1 text-center text-gray-600 text-xs md:text-sm mt-2 text-lg md:text-xl font-semibold mb-2 text-gray-800"></div>

    <!-- RSVP -->
    <section class="section" style="text-align:center;">
      <h2>Register to Attend</h2>
      <p class="lede" style="margin:24px auto 40px;">
        R200 per person. Register now to secure your spot on Microsoft Teams.
      </p>
      <a class="btn" href="https://forms.gle/GLEdi7PgXk8g1y49A" target="_blank" rel="noopener">Register now</a>
      <p style="margin-top:32px; color:var(--g-400); font-size:14px;">
        You will receive payment instructions and Teams access details within 24 hours.
      </p>
    </section>

  </main>

  <!-- Transparent Video Modal -->
  <div class="video-modal" id="videoModal" aria-hidden="true">
    <div class="video-modal__inner" id="videoPopover" role="dialog" aria-label="Video modal">
      <button class="video-modal__close" onclick="closeModal()">&times;</button>
      <video id="modalVideo" class="video-modal__video" playsinline preload="auto"></video>
      <canvas id="modalCanvas" class="video-modal__canvas"></canvas>
    </div>
  </div>

  <footer>
    © <span id="year"></span> VCB · Viable Core Business — All rights reserved.
  </footer>

  <script>document.getElementById('year').textContent = new Date().getFullYear();</script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&family=Playfair+Display:ital@1&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
    .font-playfair {
      font-family: 'Playfair Display', serif;
    }
    /* Custom utility for 3D transforms */
    .preserve-3d {
      transform-style: preserve-3d;
    }
    .perspective {
      perspective: 1000px;
    }
    .backface-hidden {
      backface-visibility: hidden;
    }
    
    /* Countdown animations */
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(212,175,55,0.4), 0 0 40px rgba(212,175,55,0.25), 0 10px 30px rgba(0,0,0,0.15); }
      50% { box-shadow: 0 0 35px rgba(212,175,55,0.6), 0 0 70px rgba(212,175,55,0.4), 0 15px 50px rgba(0,0,0,0.2); }
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-8px); }
    }
    
    .countdown-wrapper-event {
      display: inline-block;
      background: linear-gradient(135deg, rgba(255,255,255,0.98) 0%, rgba(250,250,250,0.95) 100%);
      border: 3px solid rgba(212,175,55,0.4);
      border-radius: 28px;
      padding: 40px 56px;
      backdrop-filter: blur(16px);
      animation: pulse-glow 2.5s ease-in-out infinite, float 4s ease-in-out infinite;
      box-shadow: 0 0 25px rgba(212,175,55,0.4), 0 12px 35px rgba(0,0,0,0.15);
    }
    
    .countdown-title-event {
      font-size: clamp(20px, 3.5vw, 28px);
      font-weight: 700;
      background: linear-gradient(135deg, #D4AF37 0%, #B8942D 50%, #D4AF37 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 20px;
      letter-spacing: 1px;
      text-transform: uppercase;
    }
    
    /* Bead-blasted titanium background effect */
    body::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 800"><g fill-opacity="0.02" fill="white"><rect x="0" y="0" width="800" height="800"/><g filter="url(%23noise)"><rect x="0" y="0" width="800" height="800"/></g></g><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="4" stitchTiles="stitch"/></filter></svg>');
      z-index: -1;
      pointer-events: none;
    }
    @keyframes fade-in {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
    .animate-\[fade-in_0\.3s_ease-out\] {
      animation: fade-in 0.3s ease-out;
    }
    .text-shadow-3d {
      text-shadow: 0 1px 1px hsl(0 0% 100% / 0.2), 0 2px 2px hsl(0 0% 0% / 0.6), 0 5px 10px hsl(0 0% 0% / 0.4);
    }
  </style>
  <script type="importmap">
  {
    "imports": {
      "react": "https://esm.sh/react@^18.2.0",
      "react-dom/client": "https://esm.sh/react-dom@^18.2.0/client"
    }
  }
  </script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script type="text/babel" data-type="module">
    import React, { useState, useEffect, useRef } from 'react';
    import ReactDOM from 'react-dom/client';

    // --- from components/sound.ts ---
    const playFlipSound = (audioContext, delay = 0) => {
      if (!audioContext) return;
      if (audioContext.state === 'suspended') {
        audioContext.resume();
      }

      const startTime = audioContext.currentTime + delay;
      const attackTime = 0.003;
      const decayTime = 0.1; // Reduced for a snappier sound
      const whirrDuration = 0.05; // Reduced for a snappier sound
      const mainImpactOffset = 0.02;

      const compressor = audioContext.createDynamicsCompressor();
      compressor.threshold.setValueAtTime(-30, startTime);
      compressor.knee.setValueAtTime(30, startTime);
      compressor.ratio.setValueAtTime(12, startTime);
      compressor.attack.setValueAtTime(0.003, startTime);
      compressor.release.setValueAtTime(0.15, startTime); // Reduced for a tighter sound
      compressor.connect(audioContext.destination);

      const whirrOsc = audioContext.createOscillator();
      const whirrGain = audioContext.createGain();
      whirrOsc.type = 'sawtooth';
      whirrOsc.frequency.setValueAtTime(80, startTime);
      whirrOsc.frequency.linearRampToValueAtTime(120, startTime + whirrDuration);
      
      whirrGain.gain.setValueAtTime(0, startTime);
      whirrGain.gain.linearRampToValueAtTime(0.1, startTime + attackTime);
      whirrGain.gain.exponentialRampToValueAtTime(0.0001, startTime + whirrDuration);

      whirrOsc.connect(whirrGain);
      whirrGain.connect(compressor);

      const bufferSize = audioContext.sampleRate * 0.1;
      const noiseBuffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
      const output = noiseBuffer.getChannelData(0);
      for (let i = 0; i < bufferSize; i++) {
        output[i] = Math.random() * 2 - 1;
      }

      const noiseSource = audioContext.createBufferSource();
      noiseSource.buffer = noiseBuffer;

      const noiseFilter = audioContext.createBiquadFilter();
      noiseFilter.type = 'bandpass';
      noiseFilter.frequency.setValueAtTime(900, startTime);
      noiseFilter.Q.setValueAtTime(5, startTime);

      const noiseGain = audioContext.createGain();
      noiseGain.gain.setValueAtTime(0, startTime + mainImpactOffset);
      noiseGain.gain.linearRampToValueAtTime(1.0, startTime + mainImpactOffset + attackTime);
      noiseGain.gain.exponentialRampToValueAtTime(0.0001, startTime + mainImpactOffset + decayTime);

      noiseSource.connect(noiseFilter);
      noiseFilter.connect(noiseGain);
      noiseGain.connect(compressor);

      const bodyOsc = audioContext.createOscillator();
      const bodyFilter = audioContext.createBiquadFilter();
      const bodyGain = audioContext.createGain();
      
      bodyOsc.type = 'triangle';
      bodyOsc.frequency.setValueAtTime(120, startTime);

      bodyFilter.type = 'lowpass';
      bodyFilter.frequency.setValueAtTime(300, startTime);

      bodyGain.gain.setValueAtTime(0, startTime + mainImpactOffset);
      bodyGain.gain.linearRampToValueAtTime(0.7, startTime + mainImpactOffset + attackTime);
      bodyGain.gain.exponentialRampToValueAtTime(0.0001, startTime + mainImpactOffset + decayTime);
      
      bodyOsc.connect(bodyFilter);
      bodyFilter.connect(bodyGain);
      bodyGain.connect(compressor);

      whirrOsc.start(startTime);
      whirrOsc.stop(startTime + whirrDuration);
      
      noiseSource.start(startTime + mainImpactOffset);
      noiseSource.stop(startTime + mainImpactOffset + decayTime);
      
      bodyOsc.start(startTime + mainImpactOffset);
      bodyOsc.stop(startTime + mainImpactOffset + decayTime);
    };

    // --- from components/Icons.tsx ---
    const SoundIcon = () => (
      <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 text-cyan-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
      </svg>
    );
    const MutedIcon = () => (
      <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 text-gray-500 group-hover:text-cyan-400 transition-colors duration-150" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M18 9l-6 6M12 9l6 6" />
      </svg>
    );
    const InfoIcon = () => (
        <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 text-gray-500 group-hover:text-cyan-400 transition-colors duration-150" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
    );
    const CloseIcon = () => (
        <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
          </svg>
    );

    // --- from components/FlipUnit.tsx ---
    const DigitCard = ({ digit, position }) => {
      const isTop = position === 'top';
      const baseClasses = "w-full h-full flex items-center justify-center text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-mono text-zinc-900 bg-gradient-to-b from-gray-200 via-white to-gray-300 shadow-inner [text-shadow:0_1px_1px_rgba(255,255,255,0.5)]";
      const positionClasses = isTop ? "rounded-t-lg items-end pb-1" : "rounded-b-lg items-start pt-1";
      const innerDivClasses = isTop ? "border-b border-black/20" : "";
      return (
        <div className={`${baseClasses} ${positionClasses}`}>
          <div className={`${innerDivClasses} w-full h-full flex items-center justify-center`}>
            {digit}
          </div>
        </div>
      );
    };
    const FlipUnit = ({ digit, isMuted, audioContext }) => {
      const [currentDigit, setCurrentDigit] = useState(digit);
      const [previousDigit, setPreviousDigit] = useState(digit);
      const [isFlipping, setIsFlipping] = useState(false);
      useEffect(() => {
        if (digit !== currentDigit) {
          if (!isMuted && audioContext) {
            playFlipSound(audioContext, 0.38);
          }
          setPreviousDigit(currentDigit);
          setCurrentDigit(digit);
          setIsFlipping(true);
        }
      }, [digit, currentDigit, isMuted, audioContext]);
      useEffect(() => {
        if (!isFlipping) return;
        const timeoutId = setTimeout(() => {
          setPreviousDigit(digit);
          setIsFlipping(false);
        }, 500);
        return () => clearTimeout(timeoutId);
      }, [isFlipping, digit]);
      return (
        <div className="relative w-8 h-14 sm:w-10 sm:h-16 md:w-12 md:h-20 lg:w-14 lg:h-24 perspective shadow-lg shadow-black/60 rounded-lg overflow-hidden">
          <div className="absolute top-0 left-0 w-full h-full bg-[linear-gradient(165deg,rgba(255,255,255,0.2)_0%,rgba(255,255,255,0)_20%)] z-30 pointer-events-none"></div>
          <div className="absolute top-1/2 left-0 w-full h-1/2">
            <DigitCard digit={previousDigit} position="bottom" />
          </div>
          <div className="absolute top-0 left-0 w-full h-1/2">
            <DigitCard digit={currentDigit} position="top" />
          </div>
          <div className="absolute top-1/2 -mt-px w-full h-px bg-black/50 z-20"></div>
          <div className={`absolute top-0 left-0 w-full h-1/2 origin-bottom transition-transform duration-500 ease-[cubic-bezier(0.45,0,0.55,1)] preserve-3d ${isFlipping ? '[transform:rotateX(-180deg)]' : ''}`}>
            <div className="absolute inset-0 backface-hidden z-10">
              <DigitCard digit={previousDigit} position="top" />
            </div>
            <div className="absolute inset-0 [transform:rotateX(180deg)] backface-hidden">
              <DigitCard digit={currentDigit} position="bottom" />
            </div>
          </div>
        </div>
      );
    };

    // --- from components/FlipClock.tsx ---
    const Separator = () => (
      <div className="flex flex-col gap-1.5 md:gap-2">
        <div className="w-1.5 h-1.5 md:w-2 md:h-2 rounded-full bg-gradient-to-br from-yellow-600 to-yellow-700 ring-1 ring-inset ring-yellow-800/30 shadow-sm"></div>
        <div className="w-1.5 h-1.5 md:w-2 md:h-2 rounded-full bg-gradient-to-br from-yellow-600 to-yellow-700 ring-1 ring-inset ring-yellow-800/30 shadow-sm"></div>
      </div>
    );
    const FlipClock = ({ days, hours, minutes, seconds, isMuted, audioContext }) => {
      const daysStr = days.toString().padStart(2, '0');
      const hoursStr = hours.toString().padStart(2, '0');
      const minutesStr = minutes.toString().padStart(2, '0');
      const secondsStr = seconds.toString().padStart(2, '0');
      return (
        <div className="flex items-center justify-center gap-1 md:gap-2">
          <div className="flex gap-0.5 md:gap-1">
            <FlipUnit digit={daysStr[0]} audioContext={audioContext} isMuted={isMuted} />
            <FlipUnit digit={daysStr[1]} audioContext={audioContext} isMuted={isMuted} />
          </div>
          <Separator />
          <div className="flex gap-0.5 md:gap-1">
            <FlipUnit digit={hoursStr[0]} audioContext={audioContext} isMuted={isMuted} />
            <FlipUnit digit={hoursStr[1]} audioContext={audioContext} isMuted={isMuted} />
          </div>
          <Separator />
          <div className="flex gap-0.5 md:gap-1">
            <FlipUnit digit={minutesStr[0]} audioContext={audioContext} isMuted={isMuted} />
            <FlipUnit digit={minutesStr[1]} audioContext={audioContext} isMuted={isMuted} />
          </div>
          <Separator />
          <div className="flex gap-0.5 md:gap-1">
            <FlipUnit digit={secondsStr[0]} audioContext={audioContext} isMuted={isMuted} />
            <FlipUnit digit={secondsStr[1]} audioContext={audioContext} isMuted={isMuted} />
          </div>
        </div>
      );
    };

    // --- from components/DateDisplay.tsx ---
    const DateDisplay = ({ date }) => {
      const options = { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' };
      const dateString = date.toLocaleDateString('en-US', options);
      return (
        <div className="mt-2 text-center text-gray-600 text-xs md:text-sm">
          {dateString}
        </div>
      );
    };

    // --- from App.tsx ---
    const targetDate = new Date('2025-10-16T15:00:00+02:00');
    
    const TimeLabel = ({ label }) => (
      <div className="text-center text-gray-700 text-xs md:text-sm font-semibold uppercase tracking-wider mt-2">
        {label}
      </div>
    );
    
    const App = () => {
      const [remaining, setRemaining] = useState(0);
      useEffect(() => {
        const interval = setInterval(() => {
          const now = new Date();
          const diff = targetDate - now;
          setRemaining(Math.max(0, diff));
        }, 1000);
        return () => clearInterval(interval);
      }, []);
      const days = Math.floor(remaining / (1000*60*60*24));
      const hours = Math.floor((remaining % (1000*60*60*24)) / (1000*60*60));
      const minutes = Math.floor((remaining % (1000*60*60)) / (1000*60));
      const seconds = Math.floor((remaining % (1000*60)) / 1000);
      const [isMuted, setIsMuted] = useState(true);
      const audioContextRef = useRef(null);
      return (
        <div className="countdown-wrapper-event">
          <h3 className="countdown-title-event">⚖️ Event Starts In</h3>
          <div className="flex items-center justify-center gap-2 md:gap-4">
            <div className="flex flex-col items-center">
              <div className="flex gap-1">
                <FlipUnit digit={days.toString().padStart(2, '0')[0]} audioContext={audioContextRef.current} isMuted={isMuted} />
                <FlipUnit digit={days.toString().padStart(2, '0')[1]} audioContext={audioContextRef.current} isMuted={isMuted} />
              </div>
              <TimeLabel label="Days" />
            </div>
            <Separator />
            <div className="flex flex-col items-center">
              <div className="flex gap-1">
                <FlipUnit digit={hours.toString().padStart(2, '0')[0]} audioContext={audioContextRef.current} isMuted={isMuted} />
                <FlipUnit digit={hours.toString().padStart(2, '0')[1]} audioContext={audioContextRef.current} isMuted={isMuted} />
              </div>
              <TimeLabel label="Hours" />
            </div>
            <Separator />
            <div className="flex flex-col items-center">
              <div className="flex gap-1">
                <FlipUnit digit={minutes.toString().padStart(2, '0')[0]} audioContext={audioContextRef.current} isMuted={isMuted} />
                <FlipUnit digit={minutes.toString().padStart(2, '0')[1]} audioContext={audioContextRef.current} isMuted={isMuted} />
              </div>
              <TimeLabel label="Minutes" />
            </div>
            <Separator />
            <div className="flex flex-col items-center">
              <div className="flex gap-1">
                <FlipUnit digit={seconds.toString().padStart(2, '0')[0]} audioContext={audioContextRef.current} isMuted={isMuted} />
                <FlipUnit digit={seconds.toString().padStart(2, '0')[1]} audioContext={audioContextRef.current} isMuted={isMuted} />
              </div>
              <TimeLabel label="Seconds" />
            </div>
          </div>
          <DateDisplay date={targetDate} />
        </div>
      );
    };

    // --- from index.tsx ---
    // Ensure DOM is ready before mounting
    const mountApp = () => {
      const rootElement = document.getElementById('countdown-root');
      if (!rootElement) {
        console.error("Could not find root element to mount to");
        return;
      }
      const root = ReactDOM.createRoot(rootElement);
      root.render(
        <React.StrictMode>
          <App />
        </React.StrictMode>
      );
    };

    // Mount when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', mountApp);
    } else {
      mountApp();
    }
  </script>
  <script>
    (function(){
      var modal = document.getElementById('videoModal');
      var video = document.getElementById('modalVideo');
      var canvas = document.getElementById('modalCanvas');
      var inner = document.getElementById('videoPopover');
      var gl = canvas && (canvas.getContext('webgl', {alpha:true, premultipliedAlpha:false}) || canvas.getContext('experimental-webgl', {alpha:true, premultipliedAlpha:false})) || null;
      var rafId = null;
      var ENABLE_KEYER = false; // video already has alpha, no need for keying
      try {
        var qs = new URLSearchParams(window.location.search || '');
        if (qs.has('key')) ENABLE_KEYER = (qs.get('key') === '1');
      } catch(_){}
      var usingGL = false;
      // Target white background for removal
      var key1 = [1, 1, 1]; // pure white
      var key2 = [0.95, 0.95, 0.95]; // near-white
      var tol = 0.05; // tight tolerance for white
      var program = null, tex = null, aPos = null, aUV = null, uTex = null, uKey1 = null, uKey2 = null, uTol = null;

      function clearLoop(){ if (rafId) { cancelAnimationFrame(rafId); rafId = null; } }
      function setCanvasSize(){
        if (!canvas) return;
        var rect = canvas.getBoundingClientRect();
        var dpr = window.devicePixelRatio || 1;
        var w = Math.max(1, Math.floor(rect.width * dpr));
        var h = Math.max(1, Math.floor(rect.height * dpr));
        if (canvas.width !== w || canvas.height !== h) { canvas.width = w; canvas.height = h; }
      }
      function hexToRgb01(hex){ if(!hex) return null; var h=hex.replace('#',''); if(h.length===3){ h=h.split('').map(function(c){return c+c}).join(''); } var r=parseInt(h.substr(0,2),16)/255, g=parseInt(h.substr(2,2),16)/255, b=parseInt(h.substr(4,2),16)/255; return [r,g,b]; }
      function compile(glctx, type, src){ var s=glctx.createShader(type); glctx.shaderSource(s, src); glctx.compileShader(s); if(!glctx.getShaderParameter(s, glctx.COMPILE_STATUS)){ try{console.warn(glctx.getShaderInfoLog(s));}catch(_){} glctx.deleteShader(s); return null;} return s; }
      function initGL(){ if(!gl) return false; var vs=compile(gl, gl.VERTEX_SHADER, 'attribute vec2 a_position; attribute vec2 a_texCoord; varying vec2 v_texCoord; void main(){ gl_Position=vec4(a_position,0.0,1.0); v_texCoord=a_texCoord; }'); var fs=compile(gl, gl.FRAGMENT_SHADER, 'precision mediump float; uniform sampler2D u_texture; uniform vec3 u_key1; uniform vec3 u_key2; uniform float u_tol; uniform float u_soft; varying vec2 v_texCoord; void main(){ vec4 c=texture2D(u_texture, v_texCoord); float d1=distance(c.rgb, u_key1); float d2=distance(c.rgb, u_key2); float d=min(d1,d2); float a = smoothstep(u_tol, u_tol + u_soft, d); gl_FragColor=vec4(c.rgb, a); }'); if(!vs||!fs) return false; program=gl.createProgram(); gl.attachShader(program,vs); gl.attachShader(program,fs); gl.linkProgram(program); if(!gl.getProgramParameter(program, gl.LINK_STATUS)){ try{console.warn(gl.getProgramInfoLog(program));}catch(_){} return false; } gl.useProgram(program); var quad=new Float32Array([ -1,-1, 0,1,  1,-1, 1,1,  -1,1, 0,0,  1,1, 1,0 ]); var buf=gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER, buf); gl.bufferData(gl.ARRAY_BUFFER, quad, gl.STATIC_DRAW); aPos=gl.getAttribLocation(program,'a_position'); aUV=gl.getAttribLocation(program,'a_texCoord'); gl.enableVertexAttribArray(aPos); gl.vertexAttribPointer(aPos, 2, gl.FLOAT, false, 16, 0); gl.enableVertexAttribArray(aUV); gl.vertexAttribPointer(aUV, 2, gl.FLOAT, false, 16, 8); tex=gl.createTexture(); gl.bindTexture(gl.TEXTURE_2D, tex); gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR); gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR); gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE); gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE); uTex=gl.getUniformLocation(program,'u_texture'); uKey1=gl.getUniformLocation(program,'u_key1'); uKey2=gl.getUniformLocation(program,'u_key2'); uTol=gl.getUniformLocation(program,'u_tol'); var uSoft=gl.getUniformLocation(program,'u_soft'); gl.uniform1i(uTex, 0); gl.uniform1f(uSoft, 0.10); return true; }
      function drawGL(){
        if(!usingGL || !gl) return;
        // Wait until the video has enough data before uploading to texture
        if (!video || video.readyState < 2 || !video.videoWidth || !video.videoHeight) {
          rafId = requestAnimationFrame(drawGL);
          return;
        }
        setCanvasSize();
        gl.viewport(0,0,canvas.width, canvas.height);
        gl.clearColor(0,0,0,0);
        gl.clear(gl.COLOR_BUFFER_BIT);
        gl.activeTexture(gl.TEXTURE0);
        gl.bindTexture(gl.TEXTURE_2D, tex);
        // Upload the current video frame; if WebGL errors, fallback to plain video
        try {
          gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, video);
        } catch(e) {
          fallbackToVideo(); return;
        }
        var err = gl.getError && gl.getError();
        if (err && err !== 0) { fallbackToVideo(); return; }
        gl.uniform3fv(uKey1, new Float32Array(key1));
        gl.uniform3fv(uKey2, new Float32Array(key2));
        gl.uniform1f(uTol, tol);
        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
        rafId=requestAnimationFrame(drawGL);
      }
      
      // Initialize WebGL once (gated)
      try { usingGL = ENABLE_KEYER && !!gl && initGL(); } catch(_){ usingGL = false; }

      // Auto-pick key colors by sampling corners (if same-origin)
      (function autoPickKeys(){
        if (!ENABLE_KEYER) return; // skip when keyer is off
        try{
          var s = document.createElement('canvas');
          var sctx = s.getContext('2d', { willReadFrequently: true });
          var size = 64; s.width = size; s.height = size;
          var updateKeys = function(){
            try{
              sctx.drawImage(video, 0, 0, size, size);
              var img = sctx.getImageData(0, 0, size, size).data;
              // Count colors (quantized)
              var map = Object.create(null);
              for (var y=0; y<size; y+=2){
                for (var x=0; x<size; x+=2){
                  var i=(y*size + x)*4;
                  var r=img[i], g=img[i+1], b=img[i+2];
                  r=(r>>3)<<3; g=(g>>3)<<3; b=(b>>3)<<3;
                  var k=(r<<16)|(g<<8)|b; map[k]=(map[k]||0)+1;
                }
              }
              var arr = Object.keys(map).map(function(k){return {k:+k, c:map[k]};}).sort(function(a,b){return b.c-a.c;});
              if (arr.length>=2){
                var c1 = arr[0].k, c2 = arr[1].k;
                var r1=(c1>>16)&255, g1=(c1>>8)&255, b1=c1&255;
                var r2=(c2>>16)&255, g2=(c2>>8)&255, b2=c2&255;
                key1 = [r1/255, g1/255, b1/255];
                key2 = [r2/255, g2/255, b2/255];
              }
            }catch(e){ /* ignore CORS/taint */ }
          };
          video.addEventListener('loadeddata', updateKeys, { once:true });
          video.addEventListener('play', updateKeys, { once:false });
        }catch(e){}
      })();
      function colorDist2(r1,g1,b1, r2,g2,b2){ var dr=r1-r2, dg=g1-g2, db=b1-b2; return dr*dr+dg*dg+db*db; }
      function quantize(c){ return (c>>3)<<3; }
      function detectCheckerColors(){
        if (!ctx || !canvas) return null;
        setCanvasDisplaySize();
        try { ctx.drawImage(video, 0, 0, canvas.width, canvas.height); } catch(e){ return null; }
        var sampleW = Math.min(canvas.width, 80), sampleH = Math.min(canvas.height, 80);
        var img = ctx.getImageData(0, 0, sampleW, sampleH);
        var data = img.data, map = Object.create(null);
        for (var y=0; y<sampleH; y+=2){
          for (var x=0; x<sampleW; x+=2){
            var i=(y*sampleW + x)*4;
            var r=quantize(data[i]), g=quantize(data[i+1]), b=quantize(data[i+2]);
            var k=(r<<16)|(g<<8)|b; map[k] = (map[k]||0)+1;
          }
        }
        var arr = Object.keys(map).map(function(k){ return {k: +k, c: map[k]}; }).sort(function(a,b){ return b.c-a.c; });
        if (arr.length===0) return null;
        var c1 = arr[0].k; var r1=(c1>>16)&255, g1=(c1>>8)&255, b1=c1&255;
        var c2 = null, bestCount = 0;
        for (var j=1;j<arr.length;j++){
          var k2 = arr[j].k; var r2=(k2>>16)&255, g2=(k2>>8)&255, b2=k2&255;
          var d2 = colorDist2(r1,g1,b1, r2,g2,b2);
          if (d2>1000 && arr[j].c>bestCount){ c2 = k2; bestCount = arr[j].c; }
          if (c2 && bestCount>50) break;
        }
        if (!c2 && arr[1]) c2 = arr[1].k;
        if (!c2) return { c1:[r1,g1,b1], c2:[r1,g1,b1] };
        var r2=(c2>>16)&255, g2=(c2>>8)&255, b2=c2&255;
        return { c1:[r1,g1,b1], c2:[r2,g2,b2] };
      }
      function fallbackToVideo(){
        usingGL = false;
        if (canvas) canvas.style.display = 'none';
        if (video) video.style.display = 'block';
        clearLoop();
      }

      function processFrame(){
        if (!usingGL || !ctx || !canvas || !video) return;
        setCanvasDisplaySize();
        try {
          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
          // Attempt to read pixels; if tainted, this will throw
          var img = ctx.getImageData(0,0,canvas.width, canvas.height);
          var d = img.data;
          if (!keyColors) keyColors = detectCheckerColors();
          if (keyColors){
            var r1=keyColors.c1[0], g1=keyColors.c1[1], b1=keyColors.c1[2];
            var r2=keyColors.c2[0], g2=keyColors.c2[1], b2=keyColors.c2[2];
            var thr2 = keyTolerance*keyTolerance;
            for (var i=0;i<d.length;i+=4){
              var r=d[i], g=d[i+1], b=d[i+2];
              var dA = colorDist2(r,g,b, r1,g1,b1);
              var dB = colorDist2(r,g,b, r2,g2,b2);
              if (dA<thr2 || dB<thr2){ d[i+3]=0; }
            }
            ctx.putImageData(img,0,0);
          }
        } catch(err){
          // Security (tainted canvas) or other errors -> fallback to direct video playback
          fallbackToVideo();
          return;
        }
        rafId = requestAnimationFrame(processFrame);
      }

      var currentBtn = null; var currentSide = 'right'; var isOpen = false;

      function clamp(v, min, max){ return Math.max(min, Math.min(v, max)); }

      function positionPopover(btn, side){
        if (!inner || !btn) return;
        var rect = btn.getBoundingClientRect();
        // Measure popover size; fall back to expected width/height if not laid out yet
        var pop = inner.getBoundingClientRect();
        var popW = pop.width || Math.min(window.innerWidth * 0.36, 360);
        var popH = pop.height || 200;
        var margin = 12;
        var header = document.querySelector('.top');
        var headerHeight = header ? header.offsetHeight : 0;
        var left = side === 'right' ? (rect.right + margin) : (rect.left - popW - margin);
        var top  = rect.top + rect.height/2 - popH/2;
        left = clamp(left, 8, window.innerWidth - popW - 8);
        top  = clamp(top, headerHeight + 8, window.innerHeight - popH - 8);
        inner.style.left = left + 'px';
        inner.style.top  = top  + 'px';
      }

      function openModal(btn){
        if(!modal || !video) return;
        var webmSrc = btn && btn.getAttribute("data-video-webm");
        var mp4Src = btn && btn.getAttribute("data-video-src");
        var fallbackSrc = "Videos/vee01.webm";
        var primarySrc = webmSrc || mp4Src || fallbackSrc;
        if (!primarySrc) return;

        console.log("[event modal] opening video", { webmSrc, mp4Src, primarySrc });

        // Toggle play/pause if same button, else open video
        if (isOpen && currentBtn === btn) {
          if (video.paused) {
            video.play().catch(() => {});
          } else {
            video.pause();
          }
          return;
        }

        if (canvas) canvas.style.display = "none";
        if (video) video.style.display = "block";

        try { video.pause(); } catch(e){}
        try { video.currentTime = 0; } catch(e){}

        while (video.firstChild) video.removeChild(video.firstChild);
        try { video.removeAttribute("src"); } catch(e){}

        if (webmSrc) {
          var sourceWebm = document.createElement("source");
          sourceWebm.setAttribute("src", webmSrc);
          sourceWebm.setAttribute("type", "video/webm");
          video.appendChild(sourceWebm);
        }
        if (mp4Src) {
          var sourceMp4 = document.createElement("source");
          sourceMp4.setAttribute("src", mp4Src);
          sourceMp4.setAttribute("type", "video/mp4");
          video.appendChild(sourceMp4);
        }
        if (!webmSrc && !mp4Src) {
          video.setAttribute("src", primarySrc);
        }

        video.crossOrigin = 'anonymous';
        video.loop = false;
        video.muted = true; // start muted for autoplay
        video.setAttribute("playsinline","");

        try { video.load(); } catch(e){}
        modal.classList.add("active");
        modal.setAttribute("aria-hidden", "false");
        document.body.style.overflow = 'hidden';
        currentBtn = btn; currentSide = (btn && btn.getAttribute("data-side")) || "right"; isOpen = true;
        positionPopover(currentBtn, currentSide);

        video.addEventListener('loadeddata', function() {
          var playPromise;
          try {
            playPromise = video.play();
          } catch(err) {
            console.warn("[event modal] play() threw", err);
          }

          if (playPromise && typeof playPromise.then === "function") {
            playPromise.then(function(){
              console.log("[event modal] autoplay started");
              setTimeout(function(){ video.muted = false; console.log("[event modal] unmuted after start"); }, 150);
            }).catch(function(err){
              console.warn("[event modal] autoplay blocked or failed", err);
              video.muted = false;
            });
          } else {
            setTimeout(function(){ video.muted = false; }, 150);
          }
        });

        video.addEventListener('error', function(e) {
          console.log('video load error', e);
        });

        requestAnimationFrame(function(){ positionPopover(currentBtn, currentSide); });
      }
      Array.prototype.forEach.call(document.querySelectorAll('[data-video-webm], [data-video-src]'), function(btn){
        btn.addEventListener('click', function(){
          openModal(btn);
        });
      });

      if (modal) {
        modal.addEventListener('click', function(e){ if (e.target === modal) closeModal(); });
      }
      var closeBtn = document.querySelector('.video-modal__close');
      if (closeBtn) {
        closeBtn.addEventListener('click', function(e){
          e.stopPropagation();
          closeModal();
        });
      }
      if (video) {
        video.addEventListener('click', function(e){
          e.stopPropagation();
          if (video.paused) {
            video.play().catch(() => {});
          } else {
            video.pause();
          }
        });
        // Sync canvas loop with playback state
        video.addEventListener('play', function(){ if (usingGL) { clearLoop(); drawGL(); } });
        video.addEventListener('pause', function(){ clearLoop(); });
        video.addEventListener('ended', function(){ clearLoop(); });
      }

      if (canvas) {
        canvas.addEventListener('click', function(e){
          e.stopPropagation();
          if (video.paused) {
            var p3 = video.play(); if (p3 && typeof p3.catch === 'function') { p3.catch(function(){}); }
          } else {
            video.pause();
          }
        });
      }

      document.addEventListener('keydown', function(e){ if (e.key === 'Escape') closeModal(); });
      window.addEventListener('resize', function(){ if (isOpen) positionPopover(currentBtn, currentSide); });
      window.addEventListener('scroll', function(){ if (isOpen) positionPopover(currentBtn, currentSide); }, true);
      video.addEventListener('loadedmetadata', function(){ if (isOpen) positionPopover(currentBtn, currentSide); });

      function closeModal(){
        if(!modal || !video) return;
        try { video.pause(); video.currentTime = 0; } catch(e){}
        video.removeAttribute('src');
        modal.classList.remove('active');
        modal.setAttribute('aria-hidden', 'true');
        document.body.style.overflow = '';
        clearLoop();
        isOpen = false; currentBtn = null;
      }
    })();
  </script>
</body>
</html>



















